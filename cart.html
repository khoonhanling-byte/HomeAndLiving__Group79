<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shopping Cart</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <style>
    body {
      background: #f8f9fa;
    }

    .cart-table img {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 8px;
    }

    .quantity-btn {
      padding: 0.2rem 0.6rem;
      font-size: 1rem;
    }

    .empty-cart {
      text-align: center;
      padding: 3rem;
      color: #888;
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="main.html">Home & Living</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="furniture.html">Furniture</a></li>
          <li class="nav-item"><a class="nav-link" href="HouseGadget.html">House Gadgets</a></li>
          <li class="nav-item"><a class="nav-link" href="kitchenware.html">Kitchenware</a></li>
          <!--<li class="nav-item"><a class="nav-link active" href="checkout.html">View payment</a></li> -->
        </ul>
      </div>
    </div>
  </nav>

  <!-- Cart Section -->
  <div class="container py-5">
    <h2 class="mb-4">Your Shopping Cart</h2>

    <div id="cartContainer"></div>

    <div class="text-end mt-4">
      <h4>Total: <span id="cartTotal">RM0.00</span></h4>
      <button class="btn btn-success mt-2" id="checkoutBtn">Proceed to Checkout</button>
    </div>
  </div>

  <script>
    function readCart() {
      try { return JSON.parse(localStorage.getItem('cart')) || []; }
      catch { return []; }
    }
    function writeCart(cart) {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function renderCart() {
      const cart = readCart();
      const container = document.getElementById("cartContainer");

      if (cart.length === 0) {
        container.innerHTML = `<div class="empty-cart"><h4>Your cart is empty ðŸ›’</h4></div>`;
        document.getElementById("cartTotal").innerText = "RM0.00";
        return;
      }

      let html = `
        <div class="table-responsive">
          <table class="table align-middle cart-table">
            <thead class="table-dark">
              <tr>
                <th>Product</th>
                <th>Name</th>
                <th>Price</th>
                <th style="width:140px;">Quantity</th>
                <th>Subtotal</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
      `;

      let total = 0;
      cart.forEach((item, index) => {
        let price = parseFloat(item.price) || 0;
        let image = item.image || "image/placeholder.png";
        let name = item.title || "Unnamed Item";

        let subtotal = price * item.quantity;
        total += subtotal;

        html += `
          <tr>
            <td><img src="${image}" alt="${name}"></td>
            <td>${name}</td>
            <td>RM${price.toFixed(2)}</td>
            <td>
              <div class="d-flex align-items-center">
                <button class="btn btn-sm btn-secondary quantity-btn" onclick="changeQty(${index}, -1)">-</button>
                <span class="mx-2">${item.quantity}</span>
                <button class="btn btn-sm btn-secondary quantity-btn" onclick="changeQty(${index}, 1)">+</button>
              </div>
            </td>
            <td>RM${subtotal.toFixed(2)}</td>
            <td><button class="btn btn-sm btn-danger" onclick="removeItem(${index})">Remove</button></td>
          </tr>
        `;
      });

      html += `</tbody></table></div>`;
      container.innerHTML = html;
      document.getElementById("cartTotal").innerText = "RM" + total.toFixed(2);
    }

    function changeQty(index, delta) {
      let cart = readCart();
      cart[index].quantity += delta;
      if (cart[index].quantity <= 0) cart.splice(index, 1);
      writeCart(cart);
      renderCart();
    }

    function removeItem(index) {
      let cart = readCart();
      cart.splice(index, 1);
      writeCart(cart);
      renderCart();
    }

    // Checkout placeholder
    document.getElementById("checkoutBtn").addEventListener("click", () => {
      if (readCart().length === 0) {
        alert("Your cart is empty!");
        return;
      }
      window.location.href = "payment.html";
    });

    // Initial load
    renderCart();
  </script>

</body>

</html>